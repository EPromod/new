<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dunia Pintar Anak Super ‚ú®</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">
    
    <!-- React Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { 
            font-family: 'Fredoka', sans-serif; 
            background-color: #e0e7ff;
            min-height: 100vh;
            color: #1e293b;
            overflow-x: hidden;
            margin: 0;
        }

        /* Moving Background Blobs */
        .blob-cont {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(180deg, #f0f9ff 0%, #e0e7ff 100%);
        }
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: floatBlob 20s infinite alternate;
        }
        .blob-1 { background: #60a5fa; width: 400px; height: 400px; top: -100px; left: -100px; animation-duration: 25s; }
        .blob-2 { background: #c084fc; width: 300px; height: 300px; bottom: -50px; right: -50px; animation-duration: 18s; }
        .blob-3 { background: #34d399; width: 350px; height: 350px; top: 40%; left: 40%; animation-duration: 30s; }

        @keyframes floatBlob {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(50px, 50px) rotate(20deg); }
        }

        /* Glassmorphism Panel */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
            border-radius: 32px;
        }

        /* Animations */
        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { 0% { transform: translateY(20px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
        @keyframes bounce-custom { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes shine { 0% { background-position: 200% center; } 100% { background-position: -200% center; } }

        .animate-pop { animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .animate-slide-up { animation: slideUp 0.5s ease-out; }
        .animate-bounce-slow { animation: bounce-custom 2s infinite ease-in-out; }
        .animate-shake { animation: shake 0.4s ease-in-out; }
        
        .gradient-text {
            background: linear-gradient(to right, #2563eb, #9333ea, #db2777);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        /* 3D Button Press Effect */
        .btn-3d {
            transition: all 0.1s;
            position: relative;
            top: 0;
        }
        .btn-3d:active:not(:disabled) {
            top: 4px;
            box-shadow: none !important;
            transform: scale(0.98);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.1",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
    "react/": "https://aistudiocdn.com/react@^19.2.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.31.0",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
    "vite": "https://aistudiocdn.com/vite@^7.2.6",
    "@vitejs/plugin-react": "https://aistudiocdn.com/@vitejs/plugin-react@^5.1.1"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <!-- Background Elements -->
    <div class="blob-cont">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. UTILS & HELPERS ---
        
        const Icon = ({ name, size = 24, className }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        const speak = (text) => {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'id-ID';
            utterance.rate = 1.0; 
            utterance.pitch = 1.1; 
            window.speechSynthesis.speak(utterance);
        };

        const playSound = (type) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            
            const now = ctx.currentTime;
            
            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'success') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(1000, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.4);
                osc.start(now); osc.stop(now + 0.4);
                // Chime
                setTimeout(() => {
                    const osc2 = ctx.createOscillator();
                    const gain2 = ctx.createGain();
                    osc2.connect(gain2);
                    gain2.connect(ctx.destination);
                    osc2.type = 'sine';
                    osc2.frequency.setValueAtTime(800, now + 0.1);
                    gain2.gain.setValueAtTime(0.1, now + 0.1);
                    gain2.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc2.start(now + 0.1); osc2.stop(now + 0.6);
                }, 100);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(150, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now); osc.stop(now + 0.3);
            }
        };

        // --- 2. GEMINI SERVICE ---
        const callGemini = async (apiKey, prompt) => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error(e);
                throw e;
            }
        };

        // --- 3. UI COMPONENTS ---

        const Button = ({ children, onClick, variant = 'primary', disabled, className = '', size = 'md' }) => {
            const styles = {
                primary: "bg-gradient-to-b from-blue-400 to-blue-600 text-white shadow-[0_6px_0_#1e40af] border-2 border-blue-400",
                secondary: "bg-gradient-to-b from-slate-100 to-slate-200 text-slate-700 shadow-[0_6px_0_#94a3b8] border-2 border-slate-300",
                accent: "bg-gradient-to-b from-violet-400 to-violet-600 text-white shadow-[0_6px_0_#5b21b6] border-2 border-violet-400",
                success: "bg-gradient-to-b from-emerald-400 to-emerald-600 text-white shadow-[0_6px_0_#047857] border-2 border-emerald-400",
                danger: "bg-gradient-to-b from-rose-400 to-rose-600 text-white shadow-[0_6px_0_#be123c] border-2 border-rose-400",
            };
            
            const sizes = {
                sm: "px-3 py-2 text-sm",
                md: "px-6 py-3 text-lg",
                lg: "px-8 py-4 text-xl"
            };

            return (
                <button 
                    onClick={() => { if(!disabled) { playSound('click'); onClick(); } }} 
                    disabled={disabled}
                    className={`
                        btn-3d rounded-2xl font-black transition-all flex items-center justify-center gap-2
                        ${styles[variant]} 
                        ${sizes[size]}
                        ${disabled ? 'opacity-50 grayscale cursor-not-allowed transform-none shadow-none border-transparent bg-slate-200 text-slate-400' : 'hover:brightness-110'}
                        ${className}
                    `}
                >
                    {children}
                </button>
            );
        };

        const ProgressBar = ({ current, max }) => {
            const percentage = Math.min((current / max) * 100, 100);
            return (
                <div className="w-full bg-white/50 h-6 rounded-full border border-white/50 relative overflow-hidden">
                    <div 
                        className="h-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-500 ease-out"
                        style={{ width: `${percentage}%` }}
                    >
                        <div className="w-full h-full opacity-30 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PHBhdHRlcm4gaWQ9InAiIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgcGF0dGVyblVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHBhdGggZD0iTTAgMTBMMTAgMEgyMEwxMCAxMEwwIDIwVjEweiIgZmlsbD0id2hpdGUiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0idXJsKCNwKSIvPjwvc3ZnPg==')]"></div>
                    </div>
                </div>
            );
        };

        // --- 4. FEATURE COMPONENTS ---

        const StoryMode = ({ apiKey, onComplete }) => {
            const [input, setInput] = useState('');
            const [genre, setGenre] = useState('Petualangan');
            const [story, setStory] = useState('');
            const [loading, setLoading] = useState(false);

            const genres = ['Petualangan üó∫Ô∏è', 'Hewan Lucu üêº', 'Luar Angkasa üöÄ', 'Dongeng Kerajaan üè∞', 'Super Hero ü¶∏'];

            const createStory = async () => {
                if(!input) return;
                setLoading(true);
                try {
                    const prompt = `Buatkan cerita anak pendek (maksimal 4 paragraf pendek) dengan Genre: ${genre}. Topik utama: ${input}. Gunakan bahasa Indonesia yang seru, mendidik, dan mudah dipahami anak SD. Berikan judul di awal.`;
                    const res = await callGemini(apiKey, prompt);
                    setStory(res);
                    speak(res);
                    onComplete(30);
                } catch(e) { alert("Yah, gagal buat cerita. Coba lagi ya!"); }
                setLoading(false);
            };

            return (
                <div className="space-y-6 animate-slide-up">
                    {!story ? (
                        <>
                            <div className="bg-white/60 p-6 rounded-3xl border border-white">
                                <label className="block text-sm font-bold text-slate-500 uppercase mb-2">1. Pilih Gaya Cerita</label>
                                <div className="flex flex-wrap gap-2 mb-6">
                                    {genres.map(g => (
                                        <button 
                                            key={g} 
                                            onClick={() => { playSound('click'); setGenre(g); }}
                                            className={`px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all ${genre === g ? 'bg-blue-100 border-blue-400 text-blue-600 scale-105' : 'bg-white border-slate-200 text-slate-500 hover:bg-slate-50'}`}
                                        >
                                            {g}
                                        </button>
                                    ))}
                                </div>

                                <label className="block text-sm font-bold text-slate-500 uppercase mb-2">2. Tokoh / Topik</label>
                                <input 
                                    value={input}
                                    onChange={e => setInput(e.target.value)}
                                    placeholder="Contoh: Kucing yang bisa terbang..."
                                    className="w-full p-4 text-xl font-bold text-slate-700 bg-white border-2 border-slate-200 rounded-2xl focus:border-blue-400 focus:outline-none focus:ring-4 focus:ring-blue-100 transition-all"
                                />
                            </div>
                            <Button onClick={createStory} disabled={loading} className="w-full" size="lg" variant="primary">
                                {loading ? "Sedang Mengarang..." : "‚ú® Buat Cerita Ajaib"}
                            </Button>
                        </>
                    ) : (
                        <div className="animate-pop">
                            <div className="glass-panel p-8 mb-4 relative overflow-hidden">
                                <div className="absolute top-0 right-0 p-4 opacity-10"><Icon name="book-open" size={100} /></div>
                                <div className="prose prose-lg text-slate-700 font-medium leading-relaxed whitespace-pre-wrap relative z-10">
                                    {story}
                                </div>
                            </div>
                            <div className="flex gap-3 justify-center">
                                <Button onClick={() => speak(story)} variant="success"><Icon name="volume-2" className="mr-2"/> Baca</Button>
                                <Button onClick={() => setStory('')} variant="secondary"><Icon name="refresh-ccw" className="mr-2"/> Lagi</Button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const QuizMode = ({ apiKey, onComplete }) => {
            const [q, setQ] = useState(null);
            const [loading, setLoading] = useState(false);
            const [status, setStatus] = useState('idle');
            
            const loadQuiz = async (topic) => {
                setLoading(true); setQ(null); setStatus('idle');
                const modifiers = ["Fakta unik", "Tebak ciri", "Kegunaan", "Habitat", "Teka-teki"];
                const mod = modifiers[Math.floor(Math.random()*modifiers.length)];
                
                try {
                    const prompt = `Buat 1 soal kuis pilihan ganda anak SD. Topik: ${topic}. Fokus: ${mod}. Format JSON: {"q":"Pertanyaan","opts":["A","B","C","D"],"a":"Jawaban Benar"}.`;
                    const res = await callGemini(apiKey, prompt);
                    const json = JSON.parse(res.replace(/```json|```/g, '').trim());
                    setQ({...json, topic});
                    speak(json.q);
                } catch(e) { alert("Gagal memuat soal."); }
                setLoading(false);
            };

            const answer = (opt) => {
                if(status !== 'idle') return;
                if(opt === q.a) {
                    setStatus('correct'); playSound('success'); speak("Hebat! Jawabanmu benar.");
                    onComplete(20);
                } else {
                    setStatus('wrong'); playSound('error'); speak(`Kurang tepat. Jawabannya ${q.a}`);
                }
            };

            if(!q && !loading) return (
                <div className="grid grid-cols-2 gap-4 animate-slide-up">
                    {['ü¶Å Hewan', 'ü™ê Planet', 'üî¢ Matematika', 'üáÆüá© Indonesia', 'üçé Buah', 'ü§ñ Teknologi'].map(t => (
                        <button key={t} onClick={() => loadQuiz(t)} className="bg-white p-6 rounded-3xl shadow-sm border-2 border-slate-100 hover:border-violet-300 hover:bg-violet-50 transition-all group text-left btn-3d">
                            <h3 className="text-xl font-black text-slate-700 group-hover:text-violet-600">{t}</h3>
                            <p className="text-xs text-slate-400 font-bold uppercase mt-1">Mulai &rarr;</p>
                        </button>
                    ))}
                </div>
            );

            return (
                <div className="animate-pop w-full max-w-md mx-auto">
                    {loading && <div className="text-center py-20"><div className="animate-spin text-4xl mb-4">üß†</div><p className="font-bold text-slate-500 animate-pulse">Memeras otak AI...</p></div>}
                    {q && (
                        <div className="space-y-6">
                            <div className="bg-white/80 p-3 rounded-full inline-block text-xs font-bold text-violet-600 border border-violet-100 px-4 mb-2">Topik: {q.topic}</div>
                            <h3 className="text-2xl font-black text-slate-800 leading-snug">{q.q}</h3>
                            <div className={`space-y-3 ${status === 'wrong' ? 'animate-shake' : ''}`}>
                                {q.opts.map((opt, i) => (
                                    <button 
                                        key={i} 
                                        onClick={() => answer(opt)}
                                        disabled={status !== 'idle'}
                                        className={`w-full p-4 rounded-2xl text-lg font-bold text-left border-2 transition-all btn-3d
                                            ${status === 'idle' ? 'bg-white border-slate-200 text-slate-600 hover:border-violet-400' : ''}
                                            ${status === 'correct' && opt === q.a ? 'bg-emerald-100 border-emerald-500 text-emerald-700' : ''}
                                            ${status === 'wrong' && opt === q.a ? 'bg-emerald-100 border-emerald-500 text-emerald-700' : ''}
                                            ${status === 'wrong' && opt !== q.a ? 'opacity-50 bg-rose-50 border-rose-200' : ''}
                                        `}
                                    >
                                        <span className="inline-block w-8 h-8 rounded-lg bg-black/5 text-center leading-8 mr-3 text-sm font-black opacity-50">{String.fromCharCode(65+i)}</span>
                                        {opt}
                                    </button>
                                ))}
                            </div>
                            {status !== 'idle' && <Button onClick={() => setQ(null)} variant="primary" className="w-full mt-4">Lanjut &rarr;</Button>}
                        </div>
                    )}
                </div>
            );
        };

        const ChatMode = ({ apiKey }) => {
            const [msgs, setMsgs] = useState([{role:'ai', text:'Halo! Aku teman belajarmu. Tanya apa saja ya!'}]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const endRef = useRef(null);

            useEffect(() => endRef.current?.scrollIntoView({behavior:'smooth'}), [msgs]);

            const send = async () => {
                if(!input) return;
                const newMsgs = [...msgs, {role:'user', text:input}];
                setMsgs(newMsgs); setInput(''); setLoading(true);
                try {
                    const ctx = newMsgs.map(m=>`${m.role}: ${m.text}`).join('\n');
                    const res = await callGemini(apiKey, `Jawab singkat, ramah, untuk anak SD.\n${ctx}\nAI:`);
                    setMsgs([...newMsgs, {role:'ai', text:res}]);
                    speak(res);
                } catch(e) {}
                setLoading(false);
            };

            return (
                <div className="flex flex-col h-[500px] animate-slide-up">
                    <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-white/40 rounded-3xl border border-white mb-4 shadow-inner">
                        {msgs.map((m, i) => (
                            <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                <div className={`max-w-[80%] p-4 rounded-2xl text-md font-medium shadow-sm ${m.role==='user'?'bg-blue-500 text-white rounded-tr-none':'bg-white text-slate-700 rounded-tl-none border border-slate-100'}`}>
                                    {m.text}
                                </div>
                            </div>
                        ))}
                        {loading && <div className="text-slate-400 text-xs text-center animate-pulse">Sedang mengetik...</div>}
                        <div ref={endRef}></div>
                    </div>
                    <div className="flex gap-2">
                        <input className="flex-1 p-4 rounded-2xl border-2 border-slate-200 focus:border-blue-400 outline-none font-bold text-slate-600 bg-white/80" value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} placeholder="Tulis pesan..." />
                        <Button onClick={send} variant="accent" className="aspect-square rounded-2xl"><Icon name="send"/></Button>
                    </div>
                </div>
            );
        };

        // --- 5. MAIN APP ---
        
        const App = () => {
            const [key, setKey] = useState(localStorage.getItem('API_KEY') || '');
            const [user, setUser] = useState(() => JSON.parse(localStorage.getItem('USER')) || { name: 'Jagoan', avatar: 'ü¶Å', xp: 0, level: 1 });
            const [page, setPage] = useState('home');
            const [showAvatarSelect, setShowAvatarSelect] = useState(false);

            useEffect(() => { localStorage.setItem('USER', JSON.stringify(user)); }, [user]);

            const addXp = (amount) => {
                setUser(prev => {
                    const newXp = prev.xp + amount;
                    const nextLevelXp = prev.level * 100;
                    let newLevel = prev.level;
                    if (newXp >= nextLevelXp) {
                        newLevel++;
                        playSound('success'); // Level up sound overlay
                        alert(`üéâ NAIK LEVEL! Selamat datang di Level ${newLevel}!`);
                    }
                    return { ...prev, xp: newXp, level: newLevel };
                });
            };

            const avatars = ['ü¶Å','üêØ','ü¶Ñ','üêº','üê∏','ü¶ä','ü§ñ','üëΩ','ü¶∏','üßö‚Äç‚ôÄÔ∏è'];

            if (!key) return (
                <div className="min-h-screen flex items-center justify-center p-6">
                    <div className="glass-panel p-8 w-full max-w-md text-center space-y-6 animate-pop">
                        <div className="text-6xl animate-bounce-slow">üîê</div>
                        <div>
                            <h1 className="text-3xl font-black text-slate-800">Dunia Pintar</h1>
                            <p className="text-slate-500 font-medium">Minta Ayah/Bunda masukkan Kunci Ajaib.</p>
                        </div>
                        <input id="k" className="w-full p-4 rounded-2xl border-2 border-slate-200 text-center font-bold outline-none focus:border-blue-400" placeholder="Paste API Key Gemini Disini" />
                        <Button onClick={() => { const v = document.getElementById('k').value; if(v){localStorage.setItem('API_KEY',v); setKey(v);} }} className="w-full" variant="primary">Masuk üöÄ</Button>
                    </div>
                </div>
            );

            return (
                <div className="max-w-3xl mx-auto p-4 md:p-6 pb-24">
                    {/* Header Bar */}
                    <div className="glass-panel p-3 mb-6 flex justify-between items-center sticky top-4 z-50 animate-slide-up">
                        <div className="flex items-center gap-3 cursor-pointer p-1" onClick={() => setShowAvatarSelect(!showAvatarSelect)}>
                            <div className="w-12 h-12 bg-gradient-to-tr from-yellow-300 to-orange-400 rounded-2xl flex items-center justify-center text-3xl shadow-lg border-2 border-white transform hover:scale-110 transition">{user.avatar}</div>
                            <div>
                                <h2 className="font-black text-slate-700 leading-none">{user.name}</h2>
                                <div className="text-xs font-bold text-blue-500 bg-blue-50 px-2 py-0.5 rounded-full inline-block mt-1">Level {user.level}</div>
                            </div>
                        </div>
                        <div className="flex flex-col items-end w-32 md:w-48">
                            <div className="flex items-center gap-1 text-yellow-600 font-black mb-1">
                                <Icon name="star" size={16} fill="currentColor" /> {user.xp}
                            </div>
                            <ProgressBar current={user.xp % (user.level * 100)} max={user.level * 100} />
                        </div>
                    </div>

                    {/* Avatar Selector Modal */}
                    {showAvatarSelect && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4 animate-pop">
                            <div className="glass-panel p-6 w-full max-w-sm text-center">
                                <h3 className="text-xl font-black mb-4">Pilih Karaktermu</h3>
                                <div className="grid grid-cols-5 gap-3 mb-6">
                                    {avatars.map(av => (
                                        <button key={av} onClick={() => { setUser({...user, avatar: av}); setShowAvatarSelect(false); playSound('click'); }} className={`text-3xl p-2 rounded-xl hover:bg-white/50 transition ${user.avatar === av ? 'bg-blue-200 scale-110' : ''}`}>{av}</button>
                                    ))}
                                </div>
                                <input 
                                    value={user.name} onChange={e=>setUser({...user, name: e.target.value})} 
                                    className="w-full p-3 rounded-xl border border-slate-300 text-center font-bold mb-4" placeholder="Nama Panggilan"
                                />
                                <Button onClick={() => setShowAvatarSelect(false)} variant="primary" className="w-full">Simpan</Button>
                            </div>
                        </div>
                    )}

                    {/* Main Content Area */}
                    <div className="glass-panel p-6 min-h-[60vh] relative transition-all">
                        {page === 'home' && (
                            <div className="grid gap-4 animate-pop">
                                <div className="text-center mb-4">
                                    <h1 className="text-4xl font-black gradient-text mb-2">Mau main apa hari ini?</h1>
                                </div>
                                <div onClick={() => setPage('story')} className="group cursor-pointer bg-gradient-to-r from-blue-50 to-indigo-50 hover:from-blue-100 hover:to-indigo-100 border-2 border-blue-100 p-6 rounded-[2rem] flex items-center gap-6 transition-all hover:scale-[1.02] shadow-sm">
                                    <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center text-5xl shadow-md group-hover:rotate-12 transition">üìö</div>
                                    <div className="flex-1">
                                        <h3 className="text-2xl font-black text-slate-800">Cerita Ajaib</h3>
                                        <p className="text-slate-500 font-medium">Bikin dongeng sendiri!</p>
                                    </div>
                                    <div className="bg-white p-2 rounded-full text-blue-400"><Icon name="chevron-right" /></div>
                                </div>
                                <div onClick={() => setPage('quiz')} className="group cursor-pointer bg-gradient-to-r from-violet-50 to-fuchsia-50 hover:from-violet-100 hover:to-fuchsia-100 border-2 border-violet-100 p-6 rounded-[2rem] flex items-center gap-6 transition-all hover:scale-[1.02] shadow-sm">
                                    <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center text-5xl shadow-md group-hover:-rotate-12 transition">üß†</div>
                                    <div className="flex-1">
                                        <h3 className="text-2xl font-black text-slate-800">Kuis Cerdas</h3>
                                        <p className="text-slate-500 font-medium">Asah otak biar pintar!</p>
                                    </div>
                                    <div className="bg-white p-2 rounded-full text-violet-400"><Icon name="chevron-right" /></div>
                                </div>
                                <div onClick={() => setPage('chat')} className="group cursor-pointer bg-gradient-to-r from-emerald-50 to-teal-50 hover:from-emerald-100 hover:to-teal-100 border-2 border-emerald-100 p-6 rounded-[2rem] flex items-center gap-6 transition-all hover:scale-[1.02] shadow-sm">
                                    <div className="w-20 h-20 bg-white rounded-full flex items-center justify-center text-5xl shadow-md group-hover:scale-110 transition">ü§ñ</div>
                                    <div className="flex-1">
                                        <h3 className="text-2xl font-black text-slate-800">Teman Ngobrol</h3>
                                        <p className="text-slate-500 font-medium">Tanya jawab seru.</p>
                                    </div>
                                    <div className="bg-white p-2 rounded-full text-emerald-400"><Icon name="chevron-right" /></div>
                                </div>
                            </div>
                        )}

                        {page !== 'home' && (
                            <>
                                <div className="flex items-center gap-4 mb-6 pb-4 border-b border-slate-200/50">
                                    <Button onClick={() => setPage('home')} variant="secondary" size="sm" className="rounded-xl"><Icon name="arrow-left"/></Button>
                                    <h2 className="text-2xl font-black text-slate-700">
                                        {page === 'story' ? 'üìö Pabrik Cerita' : page === 'quiz' ? 'üß† Arena Kuis' : 'ü§ñ Teman Ngobrol'}
                                    </h2>
                                </div>
                                {page === 'story' && <StoryMode apiKey={key} onComplete={addXp} />}
                                {page === 'quiz' && <QuizMode apiKey={key} onComplete={addXp} />}
                                {page === 'chat' && <ChatMode apiKey={key} />}
                            </>
                        )}
                    </div>

                    <div className="text-center mt-8">
                        <button onClick={() => {localStorage.removeItem('API_KEY'); window.location.reload()}} className="text-slate-400 text-xs font-bold hover:text-rose-500 transition">KELUAR / GANTI KUNCI</button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>